<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Super Private Browser - Ø§Ù„ØªØ­ÙƒÙ…</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background: #111827;
      color: white;
    }

    .form-input {
      width: 100%;
      background-color: #374151;
      color: white;
      padding: 0.5rem;
      border-radius: 0.375rem;
      margin-bottom: 0.5rem;
      border: 1px solid #4b5563;
      transition: all 0.3s;
    }

    .form-input:focus {
      border-color: #3b82f6;
      outline: none;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .section {
      background-color: #1f2937;
      padding: 1.5rem;
      border-radius: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .section-title {
      font-size: 1.125rem;
      font-weight: bold;
      color: #60a5fa;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn {
      border: none;
      border-radius: 0.375rem;
      color: white;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      padding: 0.5rem 1rem;
    }

    .btn-primary {
      background-color: #2563eb;
    }

    .btn-primary:hover {
      background-color: #1d4ed8;
    }

    .btn-success {
      background-color: #16a34a;
    }

    .btn-success:hover {
      background-color: #15803d;
    }

    .btn-danger {
      background-color: #dc2626;
    }

    .btn-danger:hover {
      background-color: #b91c1c;
    }

    .btn-sm {
      padding: 0.375rem 0.75rem;
      font-size: 0.875rem;
    }

    .log-success {
      color: #4ade80;
    }

    .log-error {
      color: #f87171;
    }
  </style>
</head>
<body>
  <div class="h-screen flex flex-col">
    <div class="bg-gradient-to-r from-blue-900 to-purple-900 p-4 shadow-lg">
      <h1 class="text-3xl font-bold">ğŸ”’ Super Private Browser</h1>
      <p class="text-blue-200 text-sm">Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</p>
    </div>

    <div class="flex-1 overflow-y-auto p-4 space-y-4">
      <div class="grid grid-cols-2 gap-4">
        <div class="section">
          <div class="section-title">ğŸŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ</div>
          <div class="space-y-2 text-sm">
            <p>IP: <span id="geo-ip" class="text-green-400 font-mono">?</span></p>
            <p>Ø§Ù„Ø¯ÙˆÙ„Ø©: <span id="geo-country" class="text-green-400">?</span></p>
            <p>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„: <span id="geo-country-name" class="text-green-400">?</span></p>
            <p>Ø±Ù…Ø² Ø§Ù„Ø¯ÙˆÙ„Ø©: <span id="geo-country-code" class="text-green-400 font-mono">?</span></p>
            <p>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: <span id="geo-city" class="text-green-400">?</span></p>
            <p>Ø§Ù„Ø´Ø§Ø±Ø¹: <span id="geo-street" class="text-green-400">?</span></p>
            <p>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ: <span id="geo-zip" class="text-green-400 font-mono">?</span></p>
            <p>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: <span id="geo-coords" class="text-green-400 font-mono">?</span></p>
          </div>
          <button onclick="api.refreshGeo()" class="btn btn-primary btn-sm mt-4 w-full">
            ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
          </button>
        </div>

        <div class="section">
          <div class="section-title">ğŸ’» Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</div>
          <div class="space-y-2 text-sm">
            <p>Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª: <span id="spoof-cores" class="text-blue-400">?</span></p>
            <p>Ø§Ù„Ø°Ø§ÙƒØ±Ø©: <span id="spoof-memory" class="text-blue-400">?</span> GB</p>
            <p>Ø¯Ù‚Ø© Ø§Ù„Ø´Ø§Ø´Ø©: <span id="spoof-screen" class="text-blue-400">?</span></p>
            <p>Ø§Ù„Ù„ØºØ©: <span id="spoof-language" class="text-blue-400">?</span></p>
            <p>Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©: <span id="spoof-timezone" class="text-blue-400">?</span></p>
            <p>Ø§Ù„Ù…Ù†ØµØ©: <span id="spoof-platform" class="text-blue-400">?</span></p>
            <p>Ø§Ù„Ø´Ø±ÙƒØ©: <span id="spoof-vendor" class="text-blue-400">?</span></p>
            <p>Ø·Ø±Ø§Ø² Ø§Ù„Ø¬Ù‡Ø§Ø²: <span id="spoof-device" class="text-blue-400">?</span></p>
            <p>Ù†ÙˆØ¹ Ø§Ù„Ø§ØªØµØ§Ù„: <span id="spoof-connection" class="text-blue-400">?</span></p>
          </div>
        </div>

        <div class="section col-span-2">
          <div class="section-title">ğŸŒ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ</div>
          <div class="grid grid-cols-3 gap-3 mb-3 text-sm">
            <select id="proxy-profile-select" class="form-input col-span-2">
              <option value="">Ø§Ø®ØªØ± Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù…Ø­ÙÙˆØ¸...</option>
            </select>
            <button onclick="applyProxyProfile()" class="btn btn-primary btn-sm">ØªÙØ¹ÙŠÙ„</button>
          </div>
          <div class="grid grid-cols-3 gap-3 mb-3 text-sm">
            <input id="proxy-profile-name" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ù…Ø­ÙÙˆØ¸" class="form-input col-span-2">
            <button onclick="saveProxyProfile()" class="btn btn-success btn-sm">Ø­ÙØ¸</button>
          </div>
          <div class="mb-3 text-sm">
            <button onclick="deleteProxyProfile()" class="btn btn-danger btn-sm w-full">Ø­Ø°Ù Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
          </div>
          <div class="mb-3 text-sm">
            <input id="proxy-inline" type="text" placeholder="ØµÙŠØºØ© Ø³Ø±ÙŠØ¹Ø©: IP:PORT Ø£Ùˆ IP:PORT:USER:PASS Ø£Ùˆ socks5://user:pass@ip:port" class="form-input">
            <div class="text-xs text-gray-400 mt-1">ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù„ØµÙ‚ Ø«Ù… Enter Ù„ØªØ¹Ø¨Ø¦Ø© ÙˆØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</div>
          </div>
          <div class="grid grid-cols-2 gap-3 mb-3">
            <input id="proxy-host" type="text" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ (Host/IP)" class="form-input col-span-2">
            <input id="proxy-port" type="number" placeholder="Ø§Ù„Ù…Ù†ÙØ° (Port)" class="form-input" value="8080">
            <select id="proxy-type" class="form-input">
              <option value="http">HTTP</option>
              <option value="https">HTTPS</option>
              <option value="socks5">SOCKS5</option>
              <option value="socks4">SOCKS4</option>
            </select>
          </div>
          <div class="text-xs text-gray-400 -mt-2 mb-3">Ø§Ù„Ù…Ù†ÙØ° ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 1 Ùˆ 65535.</div>
          <div id="proxy-inline-preview" class="text-xs text-gray-500 -mt-2 mb-3"></div>
          <div class="grid grid-cols-2 gap-3 mb-3">
            <input id="proxy-user" type="text" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="form-input">
            <input id="proxy-pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" class="form-input">
          </div>
          <div class="grid grid-cols-2 gap-3 mb-3 text-sm">
            <label class="flex items-center gap-2">
              <input id="proxy-auth" type="checkbox" class="accent-blue-500">
              ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ù‚Ø©
            </label>
            <label class="flex items-center gap-2">
              <input id="proxy-bypass-local" type="checkbox" class="accent-blue-500" checked>
              Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø§Ù„Ø´Ø¨ÙƒØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
            </label>
          </div>
          <div class="mb-3">
            <input id="proxy-bypass" type="text" placeholder="Ù‚Ø§Ø¦Ù…Ø© ØªØ¬Ø§ÙˆØ² (Ù…Ø«Ø§Ù„: example.com, *.local)" class="form-input">
          </div>
          <div class="flex gap-2">
            <button onclick="setProxy()" class="btn btn-success btn-sm flex-1">âœ“ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ</button>
            <button onclick="testProxy()" class="btn btn-primary btn-sm flex-1">ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ</button>
            <button onclick="clearProxy()" class="btn btn-danger btn-sm flex-1">âœ• Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ</button>
          </div>
          <div id="proxy-status" class="mt-2 text-sm text-gray-400"></div>
          <div id="proxy-validation-status" class="mt-1 text-xs text-amber-400"></div>
          <div id="proxy-test-status" class="mt-1 text-xs text-gray-400"></div>
        </div>

        <div class="section col-span-2">
          <div class="section-title">ğŸ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ²ÙˆÙŠØ± (Fingerprinting)</div>
          <div class="space-y-3">
            <div>
              <label class="block text-sm font-medium mb-1">User Agent:</label>
              <textarea id="spoof-ua" class="form-input h-12" readonly></textarea>
            </div>

            <div class="grid grid-cols-3 gap-3">
              <div>
                <label class="block text-sm font-medium mb-1">Canvas Noise:</label>
                <input id="spoof-canvas" type="text" class="form-input" readonly>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">WebGL Vendor:</label>
                <input id="spoof-webgl-v" type="text" class="form-input" readonly>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">WebGL Renderer:</label>
                <input id="spoof-webgl-r" type="text" class="form-input" readonly>
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium mb-1">Ø§Ù„Ø®Ø·ÙˆØ·:</label>
              <input id="spoof-fonts" type="text" class="form-input" readonly>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-sm font-medium mb-1">Ø¥ØµØ¯Ø§Ø± TLS:</label>
                <input id="spoof-tls-ver" type="text" class="form-input" readonly>
              </div>
              <div>
                <label class="block text-sm font-medium mb-1">ØªØ´ÙÙŠØ± TLS:</label>
                <input id="spoof-tls-ciph" type="text" class="form-input" readonly>
              </div>
            </div>

            <div class="flex gap-2">
              <button onclick="generateRandomSpoof()" class="btn btn-primary btn-sm flex-1">
                ğŸ² ØªÙˆÙ„ÙŠØ¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
              </button>
              <button onclick="generateRandomSpoof(); startBrowser()" class="btn btn-success btn-sm flex-1">
                â–¶ ØªÙˆÙ„ÙŠØ¯ ÙˆØ¨Ø¯Ø¡
              </button>
            </div>
          </div>
        </div>

        <div class="section col-span-2">
          <div class="section-title">ğŸ›¡ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®ØµÙˆØµÙŠØ©</div>
          <div class="grid grid-cols-3 gap-3 text-sm">
            <label class="flex items-center gap-2">
              <input id="privacy-trackers" type="checkbox" class="accent-blue-500">
              Ø­Ø¸Ø± Ø§Ù„Ù…ØªØªØ¨Ø¹Ø§Øª
            </label>
            <label class="flex items-center gap-2">
              <input id="privacy-ads" type="checkbox" class="accent-blue-500">
              Ø­Ø¸Ø± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
            </label>
            <label class="flex items-center gap-2">
              <input id="privacy-cookies" type="checkbox" class="accent-blue-500">
              Ø­Ø¸Ø± ÙƒÙˆÙƒÙŠØ² Ø§Ù„Ø·Ø±Ù Ø§Ù„Ø«Ø§Ù„Ø«
            </label>
          </div>
          <div class="text-xs text-gray-400 mt-2">
            ÙŠØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø¬Ù„Ø³Ø© Ø§Ù„ØªØµÙØ­ Ø§Ù„Ø­Ø§Ù„ÙŠØ©.
          </div>
        </div>

        <div class="section">
          <div class="section-title">âš™ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
          <div class="space-y-2 text-sm text-gray-300">
            <p>Ù‚Ù… Ø¨Ø­ÙØ¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£Ùˆ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§.</p>
          </div>
          <div class="flex gap-2 mt-3">
            <button onclick="exportSettings()" class="btn btn-primary btn-sm flex-1">â¬‡ï¸ ØªØµØ¯ÙŠØ±</button>
            <button onclick="importSettings()" class="btn btn-success btn-sm flex-1">â¬†ï¸ Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
          </div>
          <div id="settings-status" class="mt-2 text-xs text-gray-400"></div>
        </div>

        <div class="section">
          <div class="section-title">ğŸ“¡ Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø´Ø¨ÙƒØ©</div>
          <div id="network-container" class="bg-gray-900 rounded p-3 h-40 overflow-y-auto font-mono text-xs space-y-1 border border-gray-700">
            <div class="text-gray-500">Ù„Ù… ÙŠØªÙ… Ø±ØµØ¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯...</div>
          </div>
        </div>
      </div>

      <div class="section col-span-2">
        <div class="section-title">ğŸ“‹ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ÙˆØ§Ù„Ø£Ø®Ø·Ø§Ø¡</div>
        <div id="logs-container" class="bg-gray-900 rounded p-3 h-40 overflow-y-auto font-mono text-xs space-y-1 border border-gray-700">
          <div class="text-gray-500">Ø¬Ø§Ø±Ù Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¬Ù„Ø§Øª...</div>
        </div>
      </div>
    </div>

    <div class="bg-gray-800 p-4 border-t border-gray-700 flex gap-3 justify-center">
      <button onclick="startBrowser()" class="btn btn-success px-8 py-3 text-lg">
        â–¶ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØªØµÙØ­
      </button>
      <button onclick="clearAllData()" class="btn btn-danger px-8 py-3 text-lg">
        ğŸ—‘ï¸ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      </button>
    </div>
  </div>

  <script>
    window.api.onGeoUpdate(data => {
      document.getElementById('geo-ip').textContent = data.ip || '?';
      document.getElementById('geo-country').textContent = data.country || '?';
      document.getElementById('geo-country-name').textContent = data.countryName || '?';
      document.getElementById('geo-country-code').textContent = data.countryCode || '?';
      document.getElementById('geo-city').textContent = data.city || '?';
      document.getElementById('geo-street').textContent = data.street || '?';
      document.getElementById('geo-zip').textContent = data.postcode || '?';
      const coords = (data.lat && data.lon) ? `${data.lat.toFixed(4)}, ${data.lon.toFixed(4)}` : '?';
      document.getElementById('geo-coords').textContent = coords;
    });

    window.api.onSpoofUpdate(data => {
      document.getElementById('spoof-ua').value = data.ua || '';
      document.getElementById('spoof-canvas').value = (data.canvasNoise * 100).toFixed(1) + '%';
      document.getElementById('spoof-webgl-v').value = data.webglVendor || '';
      document.getElementById('spoof-webgl-r').value = data.webglRenderer || '';
      document.getElementById('spoof-fonts').value = (data.fonts || []).join(', ');
      document.getElementById('spoof-cores').textContent = data.hardwareConcurrency || '?';
      document.getElementById('spoof-memory').textContent = data.deviceMemory || '?';
      document.getElementById('spoof-screen').textContent = `${data.screenWidth}x${data.screenHeight}`;
      document.getElementById('spoof-language').textContent = data.language || '?';
      document.getElementById('spoof-timezone').textContent = data.timezone || '?';
      document.getElementById('spoof-platform').textContent = data.platform || '?';
      document.getElementById('spoof-vendor').textContent = data.vendor || '?';
      document.getElementById('spoof-device').textContent = data.deviceModel || '?';
      const connection = data.connection ? `${data.connection.effectiveType} â€¢ ${data.connection.downlink}Mbps` : '?';
      document.getElementById('spoof-connection').textContent = connection;
      document.getElementById('spoof-tls-ver').value = data.tlsVersion || '';
      document.getElementById('spoof-tls-ciph').value = data.tlsCipher || '';
    });

    window.api.onProxyUpdate(config => {
      const status = document.getElementById('proxy-status');
      if (!config) {
        status.textContent = 'Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø¨Ø±ÙˆÙƒØ³ÙŠ';
        document.getElementById('proxy-inline').value = '';
        document.getElementById('proxy-test-status').textContent = '';
        document.getElementById('proxy-validation-status').textContent = '';
        document.getElementById('proxy-inline-preview').textContent = '';
        document.getElementById('proxy-auth').checked = false;
        document.getElementById('proxy-bypass-local').checked = true;
        document.getElementById('proxy-bypass').value = '';
        document.getElementById('proxy-host').value = '';
        document.getElementById('proxy-port').value = 8080;
        document.getElementById('proxy-type').value = 'http';
        document.getElementById('proxy-user').value = '';
        document.getElementById('proxy-pass').value = '';
        return;
      }
      status.textContent = `âœ“ ØªÙ… ØªØ¹ÙŠÙŠÙ†: ${config.type}://${config.host}:${config.port}`;
      document.getElementById('proxy-auth').checked = !!config.authEnabled;
      document.getElementById('proxy-bypass-local').checked = !!config.bypassLocal;
      document.getElementById('proxy-bypass').value = config.bypassRules || '';
      document.getElementById('proxy-host').value = config.host || '';
      document.getElementById('proxy-port').value = config.port || 8080;
      document.getElementById('proxy-type').value = config.type || 'http';
      document.getElementById('proxy-user').value = config.username || '';
      document.getElementById('proxy-pass').value = '';
      document.getElementById('proxy-test-status').textContent = '';
      document.getElementById('proxy-validation-status').textContent = '';
      document.getElementById('proxy-inline-preview').textContent =
        `Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ø§Ù„Ø­Ø§Ù„ÙŠ: ${config.type}://${config.host}:${config.port}`;
    });

    window.api.onProxyProfilesUpdate(data => {
      const select = document.getElementById('proxy-profile-select');
      select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù…Ø­ÙÙˆØ¸...</option>';
      (data?.profiles || []).forEach(profile => {
        const option = document.createElement('option');
        option.value = profile.id;
        option.textContent = profile.name;
        if (data.activeId === profile.id) option.selected = true;
        select.appendChild(option);
      });
    });

    window.api.onPrivacyUpdate(settings => {
      document.getElementById('privacy-trackers').checked = !!settings.blockTrackers;
      document.getElementById('privacy-ads').checked = !!settings.blockAds;
      document.getElementById('privacy-cookies').checked = !!settings.blockThirdPartyCookies;
    });

    window.api.onLogUpdate(logs => {
      const container = document.getElementById('logs-container');
      if (logs.length === 0) {
        container.innerHTML = '<div class="text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</div>';
        return;
      }
      container.innerHTML = logs.map(log => {
        const className = log.isError ? 'log-error' : 'log-success';
        return `<div class="${className}">[${log.time}] ${log.msg}</div>`;
      }).join('');
      container.scrollTop = 0;
    });

    window.api.onNetworkUpdate(logs => {
      const container = document.getElementById('network-container');
      if (!logs || logs.length === 0) {
        container.innerHTML = '<div class="text-gray-500">Ù„Ù… ÙŠØªÙ… Ø±ØµØ¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯...</div>';
        return;
      }
      container.innerHTML = logs.map(log => {
        const statusClass = log.status === 'blocked' || log.status === 'error'
          ? 'text-red-400'
          : 'text-green-400';
        const reason = log.reason ? ` - ${log.reason}` : '';
        return `<div><span class="${statusClass}">[${log.time}] ${log.status}</span> <span class="text-blue-300">${log.type || 'other'}</span> ${log.url}${reason}</div>`;
      }).join('');
      container.scrollTop = 0;
    });

    function parseInlineProxy(value) {
      const trimmed = value.trim();
      if (!trimmed) return null;
      try {
        const normalized = trimmed.includes('://') ? trimmed : `http://${trimmed}`;
        const url = new URL(normalized);
        const host = url.hostname;
        const port = url.port || '';
        const username = decodeURIComponent(url.username || '');
        const password = decodeURIComponent(url.password || '');
        if (!host || !port) return null;
        const type = url.protocol.replace(':', '') || 'http';
        return {
          host,
          port,
          username,
          password,
          type,
          authEnabled: !!(username || password)
        };
      } catch (err) {
        const parts = trimmed.split(':');
        if (parts.length < 2) return null;
        const [host, port, username = '', password = ''] = parts;
        if (!host || !port) return null;
        return {
          host,
          port,
          username,
          password,
          type: 'http',
          authEnabled: !!(username || password)
        };
      }
    }

    function applyInlineProxyToFields() {
      const inline = parseInlineProxy(document.getElementById('proxy-inline').value);
      const preview = document.getElementById('proxy-inline-preview');
      if (!inline) return null;
      document.getElementById('proxy-host').value = inline.host;
      document.getElementById('proxy-port').value = inline.port;
      document.getElementById('proxy-type').value = inline.type || 'http';
      document.getElementById('proxy-user').value = inline.username || '';
      document.getElementById('proxy-pass').value = inline.password || '';
      document.getElementById('proxy-auth').checked = inline.authEnabled;
      const authLabel = inline.authEnabled ? 'Ù…Ø¹ Ù…ØµØ§Ø¯Ù‚Ø©' : 'Ø¨Ø¯ÙˆÙ† Ù…ØµØ§Ø¯Ù‚Ø©';
      preview.textContent = `ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ: ${inline.type}://${inline.host}:${inline.port} â€¢ ${authLabel}`;
      return inline;
    }

    function validateProxyFields({ host, port }) {
      const errors = [];
      const numericPort = Number.parseInt(port, 10);
      if (!host) errors.push('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ');
      if (!Number.isInteger(numericPort) || numericPort < 1 || numericPort > 65535) {
        errors.push('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ù†ÙØ° ØµØ§Ù„Ø­ Ø¨ÙŠÙ† 1 Ùˆ 65535');
      }
      return { ok: errors.length === 0, errors, port: numericPort };
    }

    function setValidationStatus(message = '', tone = 'warn') {
      const status = document.getElementById('proxy-validation-status');
      status.textContent = message;
      status.className = `mt-1 text-xs ${tone === 'ok' ? 'text-green-400' : 'text-amber-400'}`;
    }

    function clearInlinePreview() {
      document.getElementById('proxy-inline-preview').textContent = '';
    }

    function setProxy() {
      const inline = applyInlineProxyToFields();
      const host = document.getElementById('proxy-host').value.trim();
      const port = document.getElementById('proxy-port').value.trim();
      const type = document.getElementById('proxy-type').value;
      const username = document.getElementById('proxy-user').value || '';
      const password = document.getElementById('proxy-pass').value || '';
      const authEnabled = inline?.authEnabled ?? document.getElementById('proxy-auth').checked;
      const bypassLocal = document.getElementById('proxy-bypass-local').checked;
      const bypassRules = document.getElementById('proxy-bypass').value.trim();

      const validation = validateProxyFields({ host, port });
      if (!validation.ok) {
        setValidationStatus(validation.errors.join(' â€¢ '));
        return;
      }

      api.setProxy({
        host,
        port: validation.port,
        type,
        username,
        password,
        authEnabled,
        bypassLocal,
        bypassRules
      });
      document.getElementById('proxy-status').textContent = `âœ“ ØªÙ… ØªØ¹ÙŠÙŠÙ†: ${type}://${host}:${validation.port}`;
      setValidationStatus('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚', 'ok');
    }

    function saveProxyProfile() {
      const name = document.getElementById('proxy-profile-name').value.trim();
      const inline = applyInlineProxyToFields();
      const host = document.getElementById('proxy-host').value.trim();
      const port = document.getElementById('proxy-port').value.trim();
      const type = document.getElementById('proxy-type').value;
      const username = document.getElementById('proxy-user').value || '';
      const password = document.getElementById('proxy-pass').value || '';
      const authEnabled = inline?.authEnabled ?? document.getElementById('proxy-auth').checked;
      const bypassLocal = document.getElementById('proxy-bypass-local').checked;
      const bypassRules = document.getElementById('proxy-bypass').value.trim();

      if (!name) {
        setValidationStatus('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ');
        return;
      }

      const validation = validateProxyFields({ host, port });
      if (!validation.ok) {
        setValidationStatus(validation.errors.join(' â€¢ '));
        return;
      }

      api.saveProxyProfile({
        name,
        config: {
          host,
          port: validation.port,
          type,
          username,
          password,
          authEnabled,
          bypassLocal,
          bypassRules
        }
      });
      document.getElementById('proxy-profile-name').value = '';
      setValidationStatus('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'ok');
    }

    function applyProxyProfile() {
      const id = document.getElementById('proxy-profile-select').value;
      if (!id) return;
      api.selectProxyProfile(id);
    }

    function deleteProxyProfile() {
      const id = document.getElementById('proxy-profile-select').value;
      if (!id) return;
      api.deleteProxyProfile(id);
    }

    function clearProxy() {
      api.setProxy(null);
      document.getElementById('proxy-inline').value = '';
      document.getElementById('proxy-host').value = '';
      document.getElementById('proxy-port').value = 8080;
      document.getElementById('proxy-user').value = '';
      document.getElementById('proxy-pass').value = '';
      document.getElementById('proxy-auth').checked = false;
      document.getElementById('proxy-bypass-local').checked = true;
      document.getElementById('proxy-bypass').value = '';
      document.getElementById('proxy-status').textContent = 'Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø¨Ø±ÙˆÙƒØ³ÙŠ';
      document.getElementById('proxy-test-status').textContent = '';
      document.getElementById('proxy-validation-status').textContent = '';
      document.getElementById('proxy-inline-preview').textContent = '';
    }

    async function testProxy() {
      const inline = applyInlineProxyToFields();
      const host = document.getElementById('proxy-host').value.trim();
      const port = document.getElementById('proxy-port').value.trim();
      const type = document.getElementById('proxy-type').value;
      const username = document.getElementById('proxy-user').value || '';
      const password = document.getElementById('proxy-pass').value || '';
      const authEnabled = inline?.authEnabled ?? document.getElementById('proxy-auth').checked;
      const bypassLocal = document.getElementById('proxy-bypass-local').checked;
      const bypassRules = document.getElementById('proxy-bypass').value.trim();
      const status = document.getElementById('proxy-test-status');

      const validation = validateProxyFields({ host, port });
      if (!validation.ok) {
        setValidationStatus(validation.errors.join(' â€¢ '));
        return;
      }

      status.textContent = 'Ø¬Ø§Ø±Ù Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ...';
      setValidationStatus('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„...');
      const result = await api.testProxy({
        host,
        port: validation.port,
        type,
        username,
        password,
        authEnabled,
        bypassLocal,
        bypassRules
      });
      if (result?.ok) {
        status.textContent = `âœ“ Ù†Ø¬Ø­ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± â€” IP: ${result.ip} â€¢ ${result.country || '?'}`;
        setValidationStatus('Ø§Ù„Ø§ØªØµØ§Ù„ Ù†Ø§Ø¬Ø­ ÙˆÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙØ¹ÙŠÙ„.', 'ok');
      } else {
        status.textContent = `âœ• ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± â€” ${result?.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;
        setValidationStatus('ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ùˆ Ø§ØªØµØ§Ù„ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ.');
      }
    }

    function generateRandomSpoof() {
      api.generateSpoof({ random: true });
    }

    function startBrowser() {
      window.api.startBrowser();
    }

    function updatePrivacySettings() {
      const settings = {
        blockTrackers: document.getElementById('privacy-trackers').checked,
        blockAds: document.getElementById('privacy-ads').checked,
        blockThirdPartyCookies: document.getElementById('privacy-cookies').checked
      };
      api.setPrivacy(settings);
    }

    async function exportSettings() {
      const result = await api.exportSettings();
      const status = document.getElementById('settings-status');
      if (result?.canceled) {
        status.textContent = 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØµØ¯ÙŠØ±';
        return;
      }
      status.textContent = `ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰: ${result.path}`;
    }

    async function importSettings() {
      const result = await api.importSettings();
      const status = document.getElementById('settings-status');
      if (result?.canceled) {
        status.textContent = 'ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯';
        return;
      }
      status.textContent = `ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…Ù†: ${result.path}`;
    }

    function clearAllData() {
      if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ')) {
        api.clearData();
      }
    }

    ['privacy-trackers', 'privacy-ads', 'privacy-cookies'].forEach(id => {
      document.getElementById(id).addEventListener('change', updatePrivacySettings);
    });

    document.getElementById('proxy-profile-select').addEventListener('change', applyProxyProfile);
    document.getElementById('proxy-inline').addEventListener('blur', () => {
      const inline = applyInlineProxyToFields();
      if (!inline) {
        clearInlinePreview();
      }
    });
    document.getElementById('proxy-inline').addEventListener('input', () => {
      const inline = parseInlineProxy(document.getElementById('proxy-inline').value);
      if (!inline) {
        clearInlinePreview();
        return;
      }
      document.getElementById('proxy-inline-preview').textContent =
        `ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙˆÙƒØ³ÙŠ: ${inline.type}://${inline.host}:${inline.port}`;
    });
    document.getElementById('proxy-inline').addEventListener('keydown', event => {
      if (event.key === 'Enter') {
        event.preventDefault();
        setProxy();
      }
    });

    window.api.refreshGeo();
  </script>
</body>
</html>
